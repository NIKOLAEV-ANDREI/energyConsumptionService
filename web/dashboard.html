<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ ‚Äî –ê–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f8f9fa;
        color: #333;
        line-height: 1.6;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eaeaea;
      }
      h1 {
        color: #2c3e50;
        margin-bottom: 5px;
      }
      .user-info {
        color: #7f8c8d;
        font-size: 0.95rem;
      }

      /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }
      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        text-align: center;
      }
      .stat-value {
        font-size: 1.4rem;
        font-weight: bold;
        color: #2980b9;
        margin: 5px 0;
      }
      .stat-label {
        font-size: 0.9rem;
        color: #7f8c8d;
      }
      .recommendation {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 12px 15px;
        border-radius: 0 4px 4px 0;
        margin-top: 10px;
        font-size: 0.95rem;
      }

      /* –§–æ—Ä–º–∞ */
      .form-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        margin-bottom: 25px;
      }
      .form-section h2 {
        margin-bottom: 15px;
        color: #2c3e50;
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #2c3e50;
      }
      select,
      input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }
      button {
        background: #27ae60;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
      }
      button:hover {
        background: #219653;
      }
      .btn-danger {
        background: #e74c3c;
      }
      .btn-danger:hover {
        background: #c0392b;
      }
      .hint {
        font-size: 0.85rem;
        color: #7f8c8d;
        margin-top: 5px;
      }

      /* –ü—Ä–∏–±–æ—Ä—ã */
      .appliances-list {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 25px;
      }
      .appliances-list h2 {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        color: #2c3e50;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #f8f9fa;
        color: #2c3e50;
        font-weight: 600;
      }
      tr:hover {
        background: #f8f9fa;
      }

      /* –¢–∞—Ä–∏—Ñ */
      .tariff-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        margin-bottom: 25px;
      }

      /* –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ */
      .tips-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }
      .tips-section h2 {
        margin-bottom: 15px;
        color: #2c3e50;
      }
      .tip-item {
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }
      .tip-item:last-child {
        border-bottom: none;
      }
      .tip-warning {
        color: #e67e22;
      }
      .tip-success {
        color: #27ae60;
      }
      .tip-comparison {
        color: #2980b9;
      }

      /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .btn-outline {
        background: transparent;
        border: 1px solid #27ae60;
        color: #27ae60;
      }
      .btn-outline:hover {
        background: #27ae60;
        color: white;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤ */
      @media (max-width: 600px) {
        .stats,
        .form-grid {
          grid-template-columns: 1fr;
        }
        .container {
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>–ê–Ω–∞–ª–∏–∑ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è</h1>
        <p class="user-info">
          –ü—Ä–∏–≤–µ—Ç, <span id="username">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!
        </p>
      </header>

      <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">–û–±—â–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</div>
          <div class="stat-value" id="total-kwh">0.00</div>
          <div>–∫–í—Ç¬∑—á/–¥–µ–Ω—å</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
          <div class="stat-value" id="total-cost">0.00</div>
          <div>—Ä—É–±./–¥–µ–Ω—å</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
          <div class="stat-value" id="comparison">‚Äî</div>
          <div>–æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ</div>
        </div>
      </div>
      <div class="recommendation" id="main-recommendation">
        –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –ø—Ä–∏–±–æ—Ä—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
      </div>

      <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
      <div class="form-section">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–±–æ—Ä</h2>
        <div class="form-grid">
          <div>
            <label for="appliance-type">–¢–∏–ø –ø—Ä–∏–±–æ—Ä–∞</label>
            <select id="appliance-type">
              <option value="lighting">–û—Å–≤–µ—â–µ–Ω–∏–µ</option>
              <option value="fridge">–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</option>
              <option value="washing_machine">–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞</option>
              <option value="tv">–¢–µ–ª–µ–≤–∏–∑–æ—Ä</option>
              <option value="computer">–ö–æ–º–ø—å—é—Ç–µ—Ä</option>
              <option value="ac">–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä</option>
            </select>
          </div>
          <div>
            <label for="power">–ú–æ—â–Ω–æ—Å—Ç—å (–í—Ç)</label>
            <input type="number" id="power" min="1" value="100" />
            <div class="hint" id="power-hint">
              –°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞ ‚Äî 100 –í—Ç
            </div>
          </div>
          <div>
            <label for="hours">–í—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—á–∞—Å—ã/–¥–µ–Ω—å)</label>
            <input
              type="number"
              id="hours"
              min="0"
              max="24"
              step="0.5"
              value="4"
            />
          </div>
        </div>
        <button id="add-appliance">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
        <div
          id="form-error"
          style="color: #e74c3c; margin-top: 10px; min-height: 1.2rem"
        ></div>
      </div>

      <!-- –¢–∞—Ä–∏—Ñ -->
      <div class="tariff-section">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞—Ä–∏—Ñ–∞</h2>
        <div
          style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap"
        >
          <div style="flex: 1; min-width: 200px">
            <label for="tariff-input">–¢–∞—Ä–∏—Ñ (—Ä—É–±./–∫–í—Ç¬∑—á)</label>
            <input
              type="number"
              id="tariff-input"
              step="0.01"
              min="0.01"
              value="5.50"
            />
          </div>
          <button id="save-tariff" class="btn-outline">
            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ
          </button>
        </div>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–∏–±–æ—Ä–æ–≤ -->
      <div class="appliances-list">
        <h2>–í–∞—à–∏ –ø—Ä–∏–±–æ—Ä—ã</h2>
        <table id="appliances-table">
          <thead>
            <tr>
              <th>–ü—Ä–∏–±–æ—Ä</th>
              <th>–ú–æ—â–Ω–æ—Å—Ç—å (–í—Ç)</th>
              <th>–ß–∞—Å—ã/–¥–µ–Ω—å</th>
              <th>–∫–í—Ç¬∑—á/–¥–µ–Ω—å</th>
              <th>–†—É–±./–¥–µ–Ω—å</th>
              <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
            </tr>
          </thead>
          <tbody id="appliances-body">
            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
          </tbody>
        </table>
        <div
          id="no-appliances"
          style="padding: 20px; text-align: center; color: #7f8c8d"
        >
          –ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤
        </div>
      </div>

      <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
      <div class="tips-section">
        <h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏</h2>
        <div id="tips-list">
          <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ -->
      <div class="actions">
        <button id="logout" class="btn-danger">üö™ –í—ã–π—Ç–∏</button>
      </div>
    </div>

    <script>
      // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
      const AVERAGE_KWH = 7.5; // —Å—Ä–µ–¥–Ω–µ–µ –ø–æ –†–§
      const APPLIANCE_NAMES = {
        lighting: "–û—Å–≤–µ—â–µ–Ω–∏–µ",
        fridge: "–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫",
        washing_machine: "–°—Ç–∏—Ä–∞–ª–∫–∞",
        tv: "–¢–µ–ª–µ–≤–∏–∑–æ—Ä",
        computer: "–ö–æ–º–ø—å—é—Ç–µ—Ä",
        ac: "–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä",
      };
      const POWER_HINTS = {
        lighting: "–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å –ª–∞–º–ø—ã ‚Äî 10 –í—Ç",
        fridge: "–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ ‚Äî 150 –í—Ç",
        washing_machine: "–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å —Å—Ç–∏—Ä–∞–ª–∫–∏ ‚Äî 2000 –í—Ç",
        tv: "–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞ ‚Äî 100 –í—Ç",
        computer: "–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å –ü–ö ‚Äî 300 –í—Ç",
        ac: "–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–∞ ‚Äî 1000 –í—Ç",
      };

      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      let appliances = [];
      let tariff = 5.5;

      // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
      const applianceType = document.getElementById("appliance-type");
      const powerInput = document.getElementById("power");
      const hoursInput = document.getElementById("hours");
      const tariffInput = document.getElementById("tariff-input");
      const formError = document.getElementById("form-error");
      const appliancesBody = document.getElementById("appliances-body");
      const noAppliances = document.getElementById("no-appliances");

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      async function init() {
        await loadUserData();
        setupEventListeners();
        updatePowerHint();
      }

      function setupEventListeners() {
        applianceType.addEventListener("change", updatePowerHint);
        document
          .getElementById("add-appliance")
          .addEventListener("click", addAppliance);
        document
          .getElementById("save-tariff")
          .addEventListener("click", saveTariff);
        document.getElementById("logout").addEventListener("click", logout);
      }

      function updatePowerHint() {
        const type = applianceType.value;
        document.getElementById("power-hint").textContent =
          POWER_HINTS[type] || "";
      }

      async function loadUserData() {
        const res = await fetch("/energy/appliance");
        if (res.status === 401) {
          window.location.href = "index.html";
          return;
        }
        const data = await res.json();
        if (data.error) {
          alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + data.error);
          return;
        }
        tariff = data.tariff;
        tariffInput.value = tariff;
        appliances = data.appliances || [];
        renderAppliances();
        updateStats();
      }

      async function addAppliance() {
        formError.textContent = "";
        const name = applianceType.value;
        const power = parseInt(powerInput.value);
        const hours = parseFloat(hoursInput.value);

        if (!power || !hours || hours < 0 || hours > 24 || power <= 0) {
          formError.textContent = "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ—â–Ω–æ—Å—Ç—å –∏ –≤—Ä–µ–º—è";
          return;
        }

        const res = await fetch("/energy/appliance", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            name,
            power_w: power,
            hours_per_day: hours,
          }),
        });

        const data = await res.json();
        if (res.ok) {
          powerInput.value = "";
          hoursInput.value = "4";
          await loadUserData(); // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º –¥–∞–Ω–Ω—ã–µ
        } else {
          formError.textContent = data.error || "–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è";
        }
      }

      async function saveTariff() {
        const rate = parseFloat(tariffInput.value);
        if (!rate || rate <= 0) {
          alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ");
          return;
        }

        const res = await fetch("/energy/tariff", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ rate }),
        });

        const data = await res.json();
        if (res.ok) {
          tariff = rate;
          alert("–¢–∞—Ä–∏—Ñ —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
          updateStats();
        } else {
          alert("–û—à–∏–±–∫–∞: " + (data.error || "–Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å"));
        }
      }

      function renderAppliances() {
        if (appliances.length === 0) {
          appliancesBody.innerHTML = "";
          noAppliances.style.display = "block";
          return;
        }
        noAppliances.style.display = "none";
        appliancesBody.innerHTML = appliances.map(app => {
    const kwh = (app.power_w * app.hours_per_day / 1000).toFixed(2);
    const cost = (kwh * tariff).toFixed(2);
    return `
        <tr>
            <td>${APPLIANCE_NAMES[app.name] || app.name}</td>
            <td>${app.power_w}</td>
            <td>${app.hours_per_day}</td>
            <td>${kwh}</td>
            <td>${cost}</td>
            <td>
                <button class="btn-danger" onclick="removeAppliance(${app.id})">‚ùå</button>
            </td>
        </tr>
    `;
}).join('');
      }

      function updateStats() {
        const totalKwh = appliances.reduce(
          (sum, app) => sum + (app.power_w * app.hours_per_day) / 1000,
          0
        );
        const totalCost = totalKwh * tariff;
        const diffPercent = (
          ((totalKwh - AVERAGE_KWH) / AVERAGE_KWH) *
          100
        ).toFixed(0);

        document.getElementById("total-kwh").textContent = totalKwh.toFixed(2);
        document.getElementById("total-cost").textContent =
          totalCost.toFixed(2);
        document.getElementById("comparison").textContent =
          totalKwh > 0
            ? diffPercent >= 0
              ? `+${diffPercent}%`
              : `${diffPercent}%`
            : "‚Äî";

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
        let mainRec = "";
        if (totalKwh > AVERAGE_KWH * 1.2) {
          mainRec = `–í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–∞ ${Math.abs(
            diffPercent
          )}% –±–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏, —á–µ–º —Å—Ä–µ–¥–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –û—Ç–∫–ª—é—á–∞–π—Ç–µ –ø—Ä–∏–±–æ—Ä—ã –æ—Ç —Å–µ—Ç–∏!`;
        } else if (totalKwh > 0) {
          mainRec = "–û—Ç–ª–∏—á–Ω–æ! –í–∞—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã.";
        } else {
          mainRec = "–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–±–æ—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.";
        }
        document.getElementById("main-recommendation").textContent = mainRec;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–≤–µ—Ç–æ–≤
        generateTips(totalKwh);
      }

      function generateTips(totalKwh) {
        const tips = [];
        const fridge = appliances.find((a) => a.name === "fridge");
        const ac = appliances.find((a) => a.name === "ac");
        const lighting = appliances.find((a) => a.name === "lighting");

        // –°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–∏–±–æ—Ä–∞–º
        if (fridge && fridge.hours_per_day > 20) {
          tips.push({
            text: "–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—á—Ç–∏ –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–≤–µ—Ä—Ü–∞ –ø–ª–æ—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –Ω–µ—Ç –æ–±–ª–µ–¥–µ–Ω–µ–Ω–∏—è.",
            type: "success",
          });
        }

        if (ac && ac.hours_per_day > 8) {
          tips.push({
            text: `–í–∞—à –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç ${
              ac.hours_per_day
            } —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å ‚Äî —ç—Ç–æ ${(
              (ac.power_w * ac.hours_per_day) /
              1000
            ).toFixed(
              1
            )} –∫–í—Ç¬∑—á. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä (0.1 –∫–í—Ç¬∑—á).`,
            type: "warning",
          });
        }

        if (lighting && lighting.power_w > 200) {
          tips.push({
            text: "–û–±—â–∞—è –º–æ—â–Ω–æ—Å—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏—è –≤—ã—Å–æ–∫–∞. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–Ω—ã–µ –ª–∞–º–ø—ã ‚Äî –æ–Ω–∏ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –≤ 5‚Äì10 —Ä–∞–∑ –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏.",
            type: "warning",
          });
        }

        // –û–±—â–∏–µ —Å–æ–≤–µ—Ç—ã
        if (totalKwh > 12) {
          tips.push({
            text: "–í–∞—à–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 12 –∫–í—Ç¬∑—á. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–≥–∞—é—â–∏—Ö —Ä–µ–∂–∏–º–æ–≤.",
            type: "warning",
          });
        }

        if (totalKwh > 0 && totalKwh <= 5) {
          tips.push({
            text: "–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã —Ç—Ä–∞—Ç–∏—Ç–µ –º–µ–Ω—å—à–µ 5 –∫–í—Ç¬∑—á/–¥–µ–Ω—å ‚Äî —ç—Ç–æ —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ–º–∞.",
            type: "success",
          });
        }

        if (totalKwh > AVERAGE_KWH) {
          tips.push({
            text: `–°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –≤—ã —Ç—Ä–∞—Ç–∏—Ç–µ ${totalKwh.toFixed(
              1
            )} –∫–í—Ç¬∑—á/–¥–µ–Ω—å, —Å—Ä–µ–¥–Ω–µ–µ –ø–æ –†–æ—Å—Å–∏–∏ ‚Äî ${AVERAGE_KWH} –∫–í—Ç¬∑—á.`,
            type: "comparison",
          });
        }

        if (tips.length === 0 && totalKwh > 0) {
          tips.push({
            text: "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∏–±–æ—Ä—ã –Ω–∞ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏.",
            type: "success",
          });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const tipsList = document.getElementById("tips-list");
        if (tips.length === 0) {
          tipsList.innerHTML =
            '<p style="color:#7f8c8d;">–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤.</p>';
        } else {
          tipsList.innerHTML = tips
            .map(
              (tip) =>
                `<div class="tip-item tip-${tip.type}">‚Ä¢ ${tip.text}</div>`
            )
            .join("");
        }
      }

      function logout() {
        fetch("/energy/logout", { method: "POST" }).then(() => {
          window.location.href = "index.html";
        });
      }

      async function removeAppliance(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–±–æ—Ä?')) return;

    const res = await fetch(`/energy/appliance?id=${id}`, {
        method: 'DELETE'
    });

    const data = await res.json();
    if (res.ok) {
        await loadUserData(); // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º —Å–ø–∏—Å–æ–∫
    } else {
        alert('–û—à–∏–±–∫–∞: ' + (data.error || '–Ω–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å'));
    }
}

      // –ó–∞–ø—É—Å–∫
      init();
    </script>
  </body>
</html>
